# Railway Deployment Checklist

Use this list when promoting the proof of concept to Railway. It focuses on keeping the Bun runtime healthy and ensuring the adaptive onboarding demo keeps working even when the LLM is unavailable.

## 1. Pre-flight
- [ ] `bun install`
- [ ] `bun run lint`
- [ ] `bun run typecheck`
- [ ] `bun run test`
- [ ] `bun run build`

## 2. Railway service
- Environment: **Bun 1.1+** (select the Bun template or set `builder` to `Bun` in the service settings).
- Build command: `bun run build`
- Start command: `bun run start`
- Health check path: `/` (Next.js landing page)
- Autoscaling: disabled for now; set min=1, max=1 instance while the POC is evaluated.

## 3. Required variables
| Key | Notes |
| --- | ----- |
| `OPENAI_API_KEY` | Required for GPT-5 Mini. Without it the app falls back to rules and surfaces a banner. |
| `OPENAI_MODEL` | Keep at `gpt-5-mini` unless product decides to test another model. |
| `LLM_PROMPT_VERSION` | Increment when prompt changes (format: `YYYY-MM-DD-form-orchestrator`). |
| `ENABLE_LLM_ORCHESTRATION` | `true` to allow AI decisions by default. |
| `LLM_ROLLOUT_PERCENTAGE` | Percentage of sessions using the AI when the client strategy is `auto`. Use `100` during demos. |
| `ENABLE_EVAL_LOGGING` | `true` to persist JSONL logs on the server filesystem. Switch off if storage becomes an issue. |
| `EVAL_LOG_DIR` | Defaults to `eval/logs`. For Railway use a mounted volume (`/data/eval/logs`) so logs survive restarts. |
| `AIRTABLE_API_KEY` | Needed for the `push:evals` script. Keep it in Railway secrets (not available to the browser). |
| `AIRTABLE_BASE_ID` | Base that stores the `llm_decisions` table. |
| `AIRTABLE_TABLE_NAME` | Defaults to `llm_decisions`; change if you renamed the table. |
| `NEXT_PUBLIC_API_URL` | Public URL of the deployment (e.g., `https://<project>.up.railway.app`). |
| `NEXT_PUBLIC_LLM_STRATEGY` | Defaults to `llm` so reviewers see the adaptive flow by default. |
| `NEXT_PUBLIC_DEBUG` | Set to `true` during internal demos to keep the debug panel visible. |

## 4. Smoke test script (post-deploy)
1. Visit `/onboarding`.
2. Ensure the debug panel shows `Plan source: rules` on the first screen (LLM waits for signals).
3. Complete the “Basics” step; confirm the next plan is generated by `llm` and confidence renders.
4. Toggle to “Rules only” and back to confirm the fallback notice disappears.
5. Temporarily remove `OPENAI_API_KEY` (or set `ENABLE_LLM_ORCHESTRATION=false`) and redeploy: the UI should stay functional and the in-app fallback banner must appear.
6. Run `bun scripts/push-evals-to-airtable.ts --dry-run` from the Railway shell to ensure logs are reachable.

## 5. Operational tips
- Attach a persistent volume (`/data`) and set `EVAL_LOG_DIR=/data/eval/logs` so eval records survive restarts.
- Enable Railway’s request logging to monitor `/api/plan` latency; target < 1.5s when the LLM responds.
- Create a schedule to prune old logs from the volume (e.g., retain 30 days).
- Document the production API key rotation cadence; rotating the secret does not require redeploying because Railway updates env vars automatically.

## 6. Incident recovery
- If `/api/plan` logs repeated `LLM_ERROR`, toggle `ENABLE_LLM_ORCHESTRATION=false` and redeploy; the rules engine keeps running.
- Use the eval logs to replay stuck sessions locally (`bun run push:evals:dry` to inspect new entries).
- Keep the Airtable table handy so reviewers can flag problematic decisions right after a demo.

Tick each box during deployment reviews so the team can demonstrate the POC confidently on Railway.
